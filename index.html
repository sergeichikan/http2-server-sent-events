<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<script>
    let eventSource;

    const log = (msg) => {
        document.getElementById("logTextarea").textContent += `${msg}\n`;
    };

    const stop = () => {
        log("stop");
        eventSource.close();
    };

    const start = (url = document.getElementById("urlInput").value) => {

        log(`start ${url}`);

        eventSource = new EventSource(url);

        eventSource.addEventListener("open", ({ target: { readyState } }) => {
            log(`[open] readyState: ${readyState}`);
        });

        eventSource.addEventListener("error", ({ target: { readyState } }) => {
            log(`[error] readyState: ${readyState}`);
            if (readyState === EventSource.CONNECTING) {
                log(`[error] Переподключение`);
            } else if (readyState === EventSource.CLOSED) {
                log("[error] CLOSED");
            } else {
                log("[error] Произошла ошибка.");
            }
        });

        eventSource.addEventListener("end", ({ data, lastEventId }) => {
            log(`[end] id: ${lastEventId}, data: ${data}`);
        });

        eventSource.addEventListener("stop", ({ data, lastEventId }) => {
            log(`[stop] id: ${lastEventId}, data: ${data}`);
            stop();
        });

        eventSource.addEventListener("message", ({ data, lastEventId }) => {
            log(`[message] id: ${lastEventId}, data: ${data}`);
        });
    };
</script>

<input type="text" value="https://localhost:8443/sse" id="urlInput">
<button onclick="start()">Старт</button>
<button onclick="stop()">Стоп</button>
<textarea id="logTextarea" style="width: 100%; height: 400px"></textarea>

</body>
</html>
